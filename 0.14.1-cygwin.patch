--- origsrc/dconf-0.14.1/tests/engine.c	2012-10-23 10:27:50.000000000 -0500
+++ src/dconf-0.14.1/tests/engine.c	2012-12-19 01:49:36.222263700 -0600
@@ -10,6 +10,9 @@
 #include <stdio.h>
 #include <dlfcn.h>
 #include <math.h>
+#ifdef __CYGWIN__
+#include <sys/cygwin.h>
+#endif
 
 /* Interpose to catch fopen("/etc/dconf/profile/user") */
 static const gchar *filename_to_replace;
@@ -20,6 +23,12 @@ fopen (const char *filename,
        const char *mode)
 {
   static FILE * (*real_fopen) (const char *, const char *);
+#ifdef __CYGWIN__
+  static void *RTLD_NEXT = NULL;
+
+  if (!RTLD_NEXT)
+    RTLD_NEXT = dlopen ("/usr/bin/cygwin1.dll", 0);
+#endif
 
   if (!real_fopen)
     real_fopen = dlsym (RTLD_NEXT, "fopen");
@@ -877,6 +886,10 @@ test_watch_sync (void)
 int
 main (int argc, char **argv)
 {
+#ifdef __CYGWIN__
+  cygwin_internal (CW_HOOK, "fopen", fopen);
+#endif
+
   g_setenv ("XDG_CONFIG_HOME", "/HOME/.config", TRUE);
   g_unsetenv ("DCONF_PROFILE");
 
--- origsrc/dconf-0.14.1/tests/shm.c	2012-08-13 22:35:15.000000000 -0500
+++ src/dconf-0.14.1/tests/shm.c	2012-12-19 01:45:23.269795600 -0600
@@ -7,6 +7,9 @@
 #include <fcntl.h>
 #include <errno.h>
 #include <dlfcn.h>
+#ifdef __CYGWIN__
+#include <sys/cygwin.h>
+#endif
 
 #include "../shm/dconf-shm.h"
 #include "tmpdir.h"
@@ -88,6 +91,12 @@ ssize_t
 pwrite (int fd, const void *buf, size_t count, off_t offset)
 {
   static ssize_t (* real_pwrite) (int, const void *, size_t, off_t);
+#ifdef __CYGWIN__
+  static void *RTLD_NEXT = NULL;
+
+  if (!RTLD_NEXT)
+    RTLD_NEXT = dlopen ("/usr/bin/cygwin1.dll", 0);
+#endif
 
   if (!real_pwrite)
     real_pwrite = dlsym (RTLD_NEXT, "pwrite");
@@ -140,6 +149,10 @@ main (int argc, char **argv)
   gchar *temp;
   gint status;
 
+#ifdef __CYGWIN__
+  cygwin_internal (CW_HOOK, "pwrite", pwrite);
+#endif
+
   temp = dconf_test_create_tmpdir ();
 
   g_setenv ("XDG_RUNTIME_DIR", temp, TRUE);
